!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),e.exports=n(8)},function(e,t){function n(e,t){return null===e.sessionStorage.getItem(t.username)}function r(e,t){return console.log(e.sessionStorage.getItem(t.isadmin)),"true"===e.sessionStorage.getItem(t.isadmin)}var i=angular.module("mainApp",["ngRoute","loginModule","registerModule","reimbursementApp","ApartmentApp","maintenanceApp"]);angular.module("reimbursementApp",["ui.router"]),angular.module("registerModule",[]),angular.module("loginModule",[]),angular.module("ApartmentApp",[]),angular.module("maintenanceApp",[]);i.constant("seshkeys",{fname:"fname",lname:"lname",username:"username",aptid:"aptId",isadmin:"isAdmin",serviceurl:"serviceUrl",securedurl:"securedUrl"}),i.run(["$window","$location","seshkeys",function(e,t,n){var r=t.host();r&&"localhost"!==r&&(r=t.host()),e.sessionStorage.setItem(n.serviceurl,"http://"+r+":3030"),e.sessionStorage.setItem(n.securedurl,"https://"+r+":3030")}]),i.controller("NavbarCtrl",["$scope","$http","$location","$window","seshkeys","$timeout",function(e,t,i,s,o,a){e.$on("$locationChangeStart",function(){e.online=n(s,o),e.admin=r(s,o),console.log(e.admin),e.greetingMessage=s.sessionStorage.getItem(o.fname)+" "+s.sessionStorage.getItem(o.lname)}),e.$on("$locationChangeStart",function(){e.online!==!0||i.path().includes("register")||i.path("/login")}),e.isActive=function(e){return i.path().includes(e)},e.logout=function(){s.sessionStorage.clear(),t.get("http://localhost:3030/logout"),e.online=n(s,o),a(function(){i.path("/login")},2e3)},e.online=n(s,o),e.admin=!1}]),i.config(["$routeProvider",function(e){e.when("/apartments",{templateUrl:"Room_Apt/views/aptPage.html",controller:"apt_list_user"}).when("/apartments/manage",{templateUrl:"Room_Apt/views/apt_admin.html",controller:"apt_list_admin"}).when("/maintenance",{templateUrl:"Maintenance/views/Maintenance.html",controller:"maintenanceCtrl"}).when("/maintenance/manage",{templateUrl:"Maintenance/views/MaintenaceAdmin.html",controller:"maintenanceAdminCtrl"}).when("/reimbursement",{templateUrl:"reimbursement/views/reimbursement.html",controller:"BurseCtrl"}).when("/reimbursement/manage",{templateUrl:"reimbursement/views/reimbursement_admin.html",controller:"BurseAdminCtrl"}).when("/login",{templateUrl:"loginRegistration/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"loginRegistration/views/register.html",controller:"registerCtrl"})}])},function(e,t){var n=angular.module("maintenanceApp");n.controller("maintenanceAdminCtrl",["$scope","dataAdminFactory","seshkeys",function(e,t,n){e.ticketSubmission=[],e.ticketHistory=[],e.categories=t.getCategories(),e.changedTicket={};var r=function(){var n=[];return t.getAllTickets().then(function(t){n=t.data,e.ticketHistory=n},function(e){alert("getAllTickets"+e)}),n};r(),e.submitNewTicket=function(){e.ticketSubmission.push({category:e.ticket.category,description:e.ticket.description,startDate:new Date,completeDate:"",status:"Submitted",aptID:e.ticket.apartment,usr:n.username}),t.submitNewTicket(e.ticketSubmission[0]).then(function(){e.ticketSubmission.pop(),newTicket.$setPristine(),newTicket.$setUntouched()},function(){alert("failed ticket submission")})},e.getTicketById=function(e,n){t.getTicketById(e).then(function(e){n(e)},function(e){alert("failed to get ticket")})},e.updateTicket=function(n){e.getTicketById(n,function(r){for(var i=0;i<e.ticketHistory.length;i++)n==e.ticketHistory[i]._id&&(e.changedTicket=e.ticketHistory[i],t.updateTicket(e.changedTicket).then(function(e){},function(){alert("Failed Update")}))})}}])},function(e,t){var n=angular.module("maintenanceApp");n.controller("maintenanceCtrl",["$scope","dataAdminFactory","seshkeys",function(e,t,n){e.newTicket=[],e.ticketHistory=[],e.ticketSubmission=[];var r=function(n){var r=[];return t.getTicketsByUser(n).then(function(t){r=t.data,e.ticketHistory=r,console.log(e.ticketHistory)},function(e){alert(e)}),r};r(n.username),e.submitNewTicket=function(){e.ticketSubmission.push({category:e.ticket.category,description:e.ticket.description,startDate:new Date,completeDate:"",status:"Submitted",aptID:e.ticket.apartment,usr:n.username}),t.submitNewTicket(e.ticketSubmission[0]).then(function(){e.ticketSubmission.pop()},function(){alert("failed ticket submission")})}}])},function(e,t){var n=angular.module("maintenanceApp");n.factory("dataAdminFactory",["$http","seshkeys","$window",function(e,t,n){var r=n.sessionStorage.getItem(t.serviceurl),i={};return i.getAllTickets=function(){return e.get(r+"/maintenanceCheck/")},i.getCategories=function(){return["Request Item","Missing Item","Broken Item"]},i.getStatus=function(){return["Submitted","In-Progress","Complete"]},i.getTicketById=function(t){return e.get(r+"/maintenanceTicket/"+t)},i.updateTicket=function(t){return e.post(r+"/maintenanceUpdate/",t)},i.getTicketsByUser=function(t){return e.get(r+"/maintenanceCheck/"+t)},i.submitNewTicket=function(t){return e.post(r+"/maintenanceCheck/",t)},i}])},function(e,t){var n=angular.module("maintenanceApp");n.factory("dataFactory",["$http","seshkeys","$window",function(e,t,n){var r=n.sessionStorage.getItem(t.serviceurl),i={};return i.getTicketsByUser=function(){return e.get(r+"/maintenanceCheck/")},i}])},function(e,t){function n(e){return"In Progress"===e.status}function r(e){return 0===e.length}var i=angular.module("reimbursementApp");i.controller("BurseAdminCtrl",["$scope","burseService","$timeout",function(e,t,i){var s=function(){t.getAllReimbursements().then(function(t){e.burseHistory=t.data,e.emptyHistory=r(e.burseHistory),e.selected=!1},function(){alert("Failed to retreive reimbursements...")})};e.setSidebarActive=function(e){var t,n=document.getElementsByClassName("navButton");for(t=0;t<n.length;t++)angular.element(n[t]).removeClass("active");angular.element(e.target).parent().addClass("active")},e.display=function(r){t.getReimbursementById(r).then(function(t){e.displayBurse=t.data,e.selected=!0,e.completed=n(e.displayBurse)},function(){alert("Error retreiving reimbursement...")})},e.makeDecision=function(n){t.updateReimbursement(e.displayBurse,n).then(function(t){e.pending?s():e.display(e.displayBurse._id)},function(){alert("Update failed...")})},e.reset=function(){s()},e.filterForPending=function(t){return!(!e.pending||"In Progress"!==t.status)||(e.pending===!1||void 0===e.pending)},e.burseHistory=[],e.emptyHistory=!0,e.displayBurse={},e.selected=!1,e.completed=!1,s()}])},function(e,t){function n(e){var t=!1;for(index in e)""!==e[index].date&&"Select a Type"!==e[index].type&&""!==e[index].desc&&""!==e[index].amount||(t=!0);return t}function r(e){return 0===e.length}var i=angular.module("reimbursementApp");i.controller("BurseCtrl",["$scope","burseService","$window","seshkeys",function(e,t,i,s){var o=function(){t.getReimbursementsByUsername(u).then(function(t){e.burseHistory=t.data,e.emptyHistory=r(e.burseHistory)},function(){alert("Failed to retreive reimbursements...")})};e.addReimbursement=function(){n(e.burseSubmit)?alert("Must complete previous rows before adding another"):e.burseSubmit.push({date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:a})},e.submitReimbursement=function(){n(e.burseSubmit)?alert("Must complete all rows before submitting"):t.addReimbursement(e.burseSubmit).then(function(){e.burseSubmit=[{date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:a}],o()},function(){alert("Failed to submit reimbursements...")})},e.removeReimbursement=function(t){e.burseSubmit.splice(t,1)};var a=i.sessionStorage.getItem(s.fname)+" "+i.sessionStorage.getItem(s.lname),u=i.sessionStorage.getItem(s.username);e.types=t.getTypesOfBurse(),e.burseSubmit=[{date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:a}],e.burseHistory=[],o(),e.emptyHistory=r(e.burseHistory)}]),i.config(["$stateProvider",function(e){e.state("history",{templateUrl:"reimbursement_history.html"}).state("submit",{templateUrl:"reimbursement_submite.html"})}])},function(e,t){var n=angular.module("reimbursementApp");n.factory("burseService",["$http","seshkeys",function(e,t){var n={};return n.getTypesOfBurse=function(){return["Travel","Certification","Supplies"]},n.getReimbursementById=function(n){return e.get(t.serviceurl+"/reimbursements/"+n)},n.getReimbursementsByUsername=function(n){return e.get(t.serviceurl+"/reimbursement/"+n)},n.getAllReimbursements=function(){return e.get(t.serviceurl+"/reimbursements/")},n.addReimbursement=function(n){return e.post(t.serviceurl+"/reimbursements/",n)},n.updateReimbursement=function(n,r){return e.post(t.serviceurl+"/reimbursements/"+n._id+"/"+r)},n}])}]);