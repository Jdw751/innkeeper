!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),e.exports=n(14)},function(e,t){function n(e,t){e.sessionStorage.setItem(t.username,""),e.sessionStorage.setItem(t.fname,""),e.sessionStorage.setItem(t.lname,""),e.sessionStorage.setItem(t.aptid,""),e.sessionStorage.setItem(t.isadmin,"")}function r(e,t){return null!==e.sessionStorage.getItem(t.username)&&""!==e.sessionStorage.getItem(t.username)}function i(e,t){return console.log(e.sessionStorage.getItem(t.isadmin)),"true"===e.sessionStorage.getItem(t.isadmin)}var s=angular.module("mainApp",["ngRoute","loginModule","registerModule","reimbursementApp","maintenanceApp","ApartmentApp"]);angular.module("reimbursementApp",["ui.router"]),angular.module("registerModule",[]),angular.module("loginModule",[]),angular.module("ApartmentApp",[]),angular.module("maintenanceApp",[]);s.constant("seshkeys",{fname:"fname",lname:"lname",username:"username",aptid:"aptId",isadmin:"isAdmin",serviceurl:"serviceUrl",securedurl:"securedUrl"}),s.run(["$window","$location","seshkeys",function(e,t,n){var r=t.host();r&&"localhost"!==r&&(r=t.host()),e.sessionStorage.setItem(n.serviceurl,"http://"+r+":3030"),e.sessionStorage.setItem(n.securedurl,"https://"+r+":3030")}]),s.controller("NavbarCtrl",["$scope","$http","$location","$window","seshkeys","$timeout",function(e,t,s,a,o,u){e.$on("$locationChangeStart",function(){e.online=r(a,o),e.admin=i(a,o),console.log(e.admin),e.greetingMessage=a.sessionStorage.getItem(o.fname)+" "+a.sessionStorage.getItem(o.lname)}),e.$on("$locationChangeStart",function(){e.online!==!1||s.path().includes("register")||s.path("/login")}),e.isActive=function(e){return s.path().includes(e)},e.logout=function(){n(a,o),t.get("http://localhost:3030/logout"),e.online=r(a,o),u(function(){s.path("/login")},2e3)},e.online=r(a,o),e.admin=!1}]),s.config(["$routeProvider",function(e){e.when("/apartments",{templateUrl:"Room_Apt/views/aptPage.html",controller:"apt_list_user"}).when("/apartments/manage",{templateUrl:"Room_Apt/views/apt_admin.html",controller:"apt_list_admin"}).when("/maintenance",{templateUrl:"Maintenance/views/Maintenance.html",controller:"maintenanceCtrl"}).when("/maintenance/manage",{templateUrl:"Maintenance/views/MaintenanceAdmin.html",controller:"maintenanceAdminCtrl"}).when("/reimbursement",{templateUrl:"reimbursement/views/reimbursement.html",controller:"BurseCtrl"}).when("/reimbursement/manage",{templateUrl:"reimbursement/views/reimbursement_admin.html",controller:"BurseAdminCtrl"}).when("/login",{templateUrl:"loginRegistration/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"loginRegistration/views/register.html",controller:"registerCtrl"})}])},function(e,t){function n(e,t,n){e.sessionStorage.setItem(n.username,t.username),e.sessionStorage.setItem(n.fname,t.fname),e.sessionStorage.setItem(n.lname,t.lname),e.sessionStorage.setItem(n.aptid,t.aptId),e.sessionStorage.setItem(n.isadmin,t.isAdmin)}var r=angular.module("loginModule");r.controller("loginCtrl",["$scope","$window","loginFactory","seshkeys","$location","$timeout",function(e,t,r,i,s,a){e.login=function(){var o=r.tryLogin(e.loginUsername,e.loginPassword);o.then(function(e){e.data.length>1?a(function(){alert("Invalid username/password"),s.path("/login")}):(n(t,e.data.user,i),e.data.user.isAdmin===!0?s.path("/reimbursement/manage"):s.path("/reimbursement"))},function(e){a(function(){alert("Invalid username/password"),s.path("/login")})})}}])},function(e,t){var n=angular.module("registerModule");n.controller("registerCtrl",["$scope","registerFactory","$http","$location",function(e,t,n,a){var o=!1;e.register=function(){var n={username:e.registerUsername,password:e.registerPassword,email:e.registerEmail,fname:e.registerFname,lname:e.registerLname,isAdmin:!1,aptId:null};r(n.username,"Username"),r(n.password,"Password"),r(n.email,"Email"),r(n.fname,"First Name"),r(n.lname,"Last Name"),r(e.registerPassword2,"Confirm Password"),i(e.registerPassword,e.registerPassword2),o===!0?(s(),o=!1):t.createUser(n).then(function(){a.path("/login")},function(t){alert(t.data.error),e.registerUsername="",e.registerPassword="",e.registerPassword2=""})}}]);var r=function(e,t){e||(errors=!0,alert(t+" is required."))},i=function(e,t){e!=t&&(errors=!0,alert("Passwords do not match"))},s=function(){$scope.registerUsername="",$scope.registerPassword="",$scope.registerPassword2="",$scope.registerEmail="",$scope.registerFname="",$scope.registerLname=""}},function(e,t){var n=angular.module("loginModule");n.factory("loginFactory",["$http","$window","$timeout","seshkeys",function(e,t,n,r){var i={};return i.tryLogin=function(n,i){return e.post(t.sessionStorage.getItem(r.serviceurl)+"/login",{username:n,password:i})},i}])},function(e,t){var n=angular.module("registerModule");n.factory("registerFactory",["$http","$window","seshkeys",function(e,t,n){var r={};return r.createUser=function(r){return e.post(t.sessionStorage.getItem(n.serviceurl)+"/createUser",r)},r}])},function(e,t){var n=angular.module("maintenanceApp");n.controller("maintenanceAdminCtrl",["$scope","dataAdminFactory","seshkeys",function(e,t,n){e.ticketSubmission=[],e.ticketHistory=[],e.categories=t.getCategories(),e.changedTicket={};var r=function(){var n=[];return t.getAllTickets().then(function(t){n=t.data,e.ticketHistory=n},function(e){alert("getAllTickets"+e)}),n};r(),e.submitNewTicket=function(){e.ticketSubmission.push({category:e.ticket.category,description:e.ticket.description,startDate:new Date,completeDate:"",status:"Submitted",aptID:n.aptid,usr:n.username}),t.submitNewTicket(e.ticketSubmission[0]).then(function(){e.ticketSubmission.pop(),newTicket.$setPristine(),newTicket.$setUntouched(),e.ticket.category},function(){alert("failed ticket submission")})},e.getTicketById=function(e,n){t.getTicketById(e).then(function(e){n(e)},function(e){alert("failed to get ticket")})},e.updateTicket=function(n){e.getTicketById(n,function(i){for(var s=0;s<e.ticketHistory.length;s++)n==e.ticketHistory[s]._id&&(e.changedTicket=e.ticketHistory[s],t.updateTicket(e.changedTicket).then(function(e){r()},function(){}))})}}])},function(e,t){var n=angular.module("maintenanceApp");n.controller("maintenanceCtrl",["$scope","dataAdminFactory","seshkeys",function(e,t,n){e.newTicket=[],e.ticketHistory=[],e.ticketSubmission=[];var r=function(n){var r=[];return t.getTicketsByUser(n).then(function(t){r=t.data,e.ticketHistory=r,console.log(e.ticketHistory)},function(e){alert(e)}),r};r(n.username),e.submitNewTicket=function(){e.ticketSubmission.push({category:e.ticket.category,description:e.ticket.description,startDate:new Date,completeDate:"",status:"Submitted",aptID:n.aptid,usr:n.username}),t.submitNewTicket(e.ticketSubmission[0]).then(function(){e.ticketSubmission.pop()},function(){alert("failed ticket submission")})}}])},function(e,t){var n=angular.module("maintenanceApp");n.factory("dataAdminFactory",["$http","seshkeys","$window",function(e,t,n){var r=n.sessionStorage.getItem(t.serviceurl),i={};return i.getAllTickets=function(){return e.get(r+"/maintenanceCheck/")},i.getCategories=function(){return["Request Item","Missing Item","Broken Item"]},i.getStatus=function(){return["Submitted","In-Progress","Complete"]},i.getTicketById=function(t){return e.get(r+"/maintenanceTicket/"+t)},i.updateTicket=function(t){return e.post(r+"/maintenanceUpdate/",t)},i.getTicketsByUser=function(t){return e.get(r+"/maintenanceCheck/"+t)},i.submitNewTicket=function(t){return e.post(r+"/maintenanceCheck/",t)},i}])},function(e,t){var n=angular.module("maintenanceApp");n.factory("dataFactory",["$http","seshkeys","$window",function(e,t,n){var r=n.sessionStorage.getItem(t.serviceurl),i={};return i.getTicketsByUser=function(){return e.get(r+"/maintenanceCheck/")},i}])},function(e,t){function n(e){return"In Progress"===e.status}function r(e){return 0===e.length}var i=angular.module("reimbursementApp");i.controller("BurseAdminCtrl",["$scope","burseService","$timeout",function(e,t,i){var s=function(){t.getAllReimbursements().then(function(t){e.burseHistory=t.data,e.emptyHistory=r(e.burseHistory),e.selected=!1},function(){alert("Failed to retreive reimbursements...")})};e.setSidebarActive=function(e){var t,n=document.getElementsByClassName("navButton");for(t=0;t<n.length;t++)angular.element(n[t]).removeClass("active");angular.element(e.target).parent().addClass("active")},e.display=function(r){t.getReimbursementById(r).then(function(t){e.displayBurse=t.data,e.selected=!0,e.completed=n(e.displayBurse)},function(){alert("Error retreiving reimbursement...")})},e.makeDecision=function(n){t.updateReimbursement(e.displayBurse,n).then(function(t){e.pending?s():e.display(e.displayBurse._id)},function(){alert("Update failed...")})},e.reset=function(){s()},e.filterForPending=function(t){return!(!e.pending||"In Progress"!==t.status)||(e.pending===!1||void 0===e.pending)},e.burseHistory=[],e.emptyHistory=!0,e.displayBurse={},e.selected=!1,e.completed=!1,s()}])},function(e,t){function n(e){var t=!1;for(index in e)""!==e[index].date&&"Select a Type"!==e[index].type&&""!==e[index].desc&&""!==e[index].amount||(t=!0);return t}function r(e){return 0===e.length}var i=angular.module("reimbursementApp");i.controller("BurseCtrl",["$scope","burseService","$window","seshkeys",function(e,t,i,s){var a=function(){t.getReimbursementsByUsername(u).then(function(t){e.burseHistory=t.data,e.emptyHistory=r(e.burseHistory)},function(){alert("Failed to retreive reimbursements...")})};e.addReimbursement=function(){n(e.burseSubmit)?alert("Must complete previous rows before adding another"):e.burseSubmit.push({date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:o})},e.submitReimbursement=function(){console.log(e.burseSubmit),n(e.burseSubmit)?alert("Must complete all rows before submitting"):t.addReimbursement(e.burseSubmit).then(function(){e.burseSubmit=[{date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:o}],a()},function(){alert("Failed to submit reimbursements...")})},e.removeReimbursement=function(t){e.burseSubmit.splice(t,1)};var o=i.sessionStorage.getItem(s.fname)+" "+i.sessionStorage.getItem(s.lname),u=i.sessionStorage.getItem(s.username);e.types=t.getTypesOfBurse(),e.burseSubmit=[{date:"",type:"Select a Type",desc:"",amount:"",status:"In Progress",usrname:u,name:o}],e.burseHistory=[],a(),e.emptyHistory=r(e.burseHistory)}]),i.config(["$stateProvider",function(e){e.state("history",{url:"/reimbursement",templateUrl:"reimbursement/views/reimbursement_history.html"}).state("submit",{templateUrl:"reimbursement/views/reimbursement_submit.html"})}])},function(e,t){var n=angular.module("reimbursementApp");n.factory("burseService",["$http","$window","seshkeys",function(e,t,n){var r={};return r.getTypesOfBurse=function(){return["Travel","Certification","Supplies"]},r.getReimbursementById=function(r){return e.get(t.sessionStorage.getItem(n.serviceurl)+"/reimbursements/"+r)},r.getReimbursementsByUsername=function(r){return e.get(t.sessionStorage.getItem(n.serviceurl)+"/reimbursement/"+r)},r.getAllReimbursements=function(){return e.get(t.sessionStorage.getItem(n.serviceurl)+"/reimbursements/")},r.addReimbursement=function(r){return e.post(t.sessionStorage.getItem(n.serviceurl)+"/reimbursements/",r)},r.updateReimbursement=function(r,i){return e.post(t.sessionStorage.getItem(n.serviceurl)+"/reimbursements/"+r._id+"/"+i)},r}])},function(e,t){var n=angular.module("ApartmentApp");n.controller("apt_list_admin",["$scope","$window","seshkeys","myfact",function(e,t,n,r){var i,s={},o={},u={};e.hide=!1,e.show=!1,e.hidden=!0,e.sheath=!1,e.Apartmenthide=!0,e.Userhide=!0,e.Lookuphide=!0,e.dynamic=!0;r.getUser().then(function(e){o=e.data}),r.getAllApartments().then(function(e){s=e.data}),e.trigger=function(){r.getUser().then(function(e){o=e.data}),r.getAllApartments().then(function(e){s=e.data}),e.newUser=[],e.aptList=[];for(m in s)e.aptList.push(s[m].addr);for(m in o)null!==o[m].aptId&&"null"!==o[m].aptId||e.newUser.push(o[m].username);e.sheath=!0},e.search=function(){r.getUser().then(function(e){o=e.data});for(m in o)if(o[m].username===e.username){i=o[m].aptId;break}for(m in s)s[m]._id===i&&(e.data=s[m],e.show=!0)};var m=!1;e.dosomething=function(t,n){13===t.which&&e.search(n)},e.anotherApt=function(){if(void 0===e.aptNum||void 0===e.Street||void 0===e.State||void 0===e.City||void 0===e.Zip||void 0===e.SuiteNo)confirm("Value was left blank");else for(a in s){if(e.aptNum===s[a].addr.num&&e.Street===s[a].addr.street&&e.City===s[a].addr.city&&e.Zip===s[a].addr.zip&&e.SuiteNo===s[a].addr.suite){confirm("apartment taken");break}u.addr={num:e.aptNum,street:e.Street,state:e.State,city:e.City,zip:e.Zip,suite:e.SuiteNo},e.hide=!0;break}},e.updateApt=function(){void 0!==e.chairs&&void 0!==e.beds||confirm("Value was left blank"),u.rooms=[{bedrooms:[{room:{chair:e.chairs,bed:e.beds}},{room:{chair:e.chairs,bed:e.beds}},{room:{chair:e.chairs,bed:e.beds}},{room:{chair:e.chairs,bed:e.beds}},{room:{chair:e.chairs,bed:e.beds}},{room:{chair:e.chairs,bed:e.beds}}]}],console.log(u),r.addApartment(u),e.aptNum="",e.Street="",e.State="",e.City="",e.Zip="",e.SuiteNo="",e.hide=!1},e.changeApt=function(){e.hidden=!1,e.show=!1},e.editApt=function(){r.updateUser(e.username,e.NewAptID)},e.assign=function(t){e.usernames=t,e.dynamic=!1},e.assign2=function(){r.updateUser(e.username,null),t.sessionStorage.setItem(n.aptid,null),r.getUser().then(function(e){o=e.data}),e.username="",e.data="",e.NewAptID="",e.hidden=!0,e.trigger()},e.assign3=function(t){r.updateUser(e.usernames,s[t]._id),confirm("This user has now been assigned an apartment"),e.dynamic=!0,e.sheath=!1},e.iDGen=function(){e.AptId=e.aptNum},e.Lookup=function(){e.Apartmenthide=!0,e.Userhide=!0,e.Lookuphide=!1,e.sheath=!1,e.newUser=[],e.dynamic=!0},e.New=function(){e.Apartmenthide=!1,e.Userhide=!0,e.Lookuphide=!0,e.sheath=!1,e.newUser=[],e.dynamic=!0},e.Vacant=function(){e.Apartmenthide=!0,e.Userhide=!1,e.Lookuphide=!0,e.sheath=!1,e.newUser=[]}}]),n.controller("apt_list_user",["$scope","$window","seshkeys","myfact",function(e,t,n,r){var i={};e.data={};var s=function(){r.getAllApartments().then(function(e){i=e.data,a()},function(e){console.log(e)})},a=function(){for(x in i)i[x]._id===t.sessionStorage.getItem(n.aptid)&&(e.data=i[x],console.log(e.data));console.log(e.data),null===t.sessionStorage.getItem(n.aptid)?e.userhide=!0:e.userhide=!1};s()}])},function(e,t){var n=angular.module("ApartmentApp");n.factory("myfact",["$http","$window","seshkeys",function(e,t,n){var r=t.sessionStorage.getItem(n.serviceurl),i={};return i.getAllApartments=function(){return e.get(r+"/apartments")},i.getUser=function(){return e.get(r+"/apartments/allusers")},i.updateUser=function(t,n){return e.post(r+"/apartments/allusers/"+t+"/"+n)},i.addApartment=function(t){return console.log(t),e.post(r+"/apartments",t)},i}])}]);